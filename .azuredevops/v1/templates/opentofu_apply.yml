# Requirements:
# - OpenTofu is installed on pipeline agent
# - opentofu init

parameters:
- name: enabled
  type: boolean
  default: true

- name: continueOnError
  type: boolean
  default: false

steps:
- download: current
  artifact: lakehouse

- task: AzureCLI@2
  displayName: tofu show
  inputs:
    azureSubscription: pers-reg-dev-eu-krijn
    scriptType: bash
    scriptLocation: inlineScript
    inlineScript: |
      tofu show $(Pipeline.Workspace)/lakehouse/plan.out

- task: AzureCLI@2
  displayName: tofu apply
  inputs:
    azureSubscription: pers-reg-dev-eu-krijn
    scriptType: bash
    scriptLocation: inlineScript
    inlineScript: |
      tofu apply $(Pipeline.Workspace)/lakehouse/plan.out
