parameters:
- name: enabled
  type: boolean
  default: true

- name: continueOnError
  type: boolean
  default: false

- name: openTofuDir
  type: string

steps:
- task: AzureCLI@2
  displayName: OpenTofu SPN
  inputs:
    azureSubscription: pers-reg-dev-eu-krijn
    scriptType: bash
    addSpnToEnvironment: taskrue
    scriptLocation: inlineScript
    inlineScript: |
      export ARM_CLIENT_ID=$servicePrincipalId
      export ARM_CLIENT_SECRET=$servicePrincipalKey
      export ARM_SUBSCRIPTION_ID=$(az account show --query id --output tsv)
      export ARM_TENANT_ID=$(az account show --query tenantId --output tsv)
      
      echo "ARM_CLIENT_ID: $ARM_CLIENT_ID"
      echo "ARM_CLIENT_SECRET: $ARM_CLIENT_SECRET"
      echo "ARM_SUBSCRIPTION_ID: $ARM_SUBSCRIPTION_ID"
      echo "ARM_TENANT_ID: $ARM_TENANT_ID"
      
      tofu init
    workingDirectory: ${{ parameters.openTofuDir }}